<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1.0">
    <!-- Add jquery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>Streaming Availability</title>
    <header><h1>Streaming Availability</h1></header>

<body>
    <main>
        <!-- Add search input -->
        <input type="text" id="search" placeholder="Search for a movie">
        <button id="searchBtn">Search</button>
        <div>
            <!-- Add results here -->
            <p id="results"></p>
        </div>
    </main>
    <script>
        var API_KEY = "7871a3a984msh9c8fac100c1803dp118287jsnb2f0f33c75ea";
        var BASE_URL = "streaming-availability.p.rapidapi.com";
        const options = {
            method: 'GET',
            headers: {
                'X-RapidAPI-Key': API_KEY,
                'X-RapidAPI-Host': BASE_URL
            }
        };

        var services = "netflix,prime,disney,hbo,hulu";//peacock,paramount,starz,showtime,apple,mubi";
        var logos = {
            "netflix": "https://upload.wikimedia.org/wikipedia/commons/thumb/0/08/Netflix_2015_logo.svg/330px-Netflix_2015_logo.svg.png",
            "prime": "https://upload.wikimedia.org/wikipedia/commons/thumb/1/11/Amazon_Prime_Video_logo.svg/338px-Amazon_Prime_Video_logo.svg.png",
            "disney": "https://upload.wikimedia.org/wikipedia/commons/thumb/3/3e/Disney%2B_logo.svg/300px-Disney%2B_logo.svg.png",
            "hbo": "https://upload.wikimedia.org/wikipedia/commons/thumb/1/17/HBO_Max_Logo.svg/330px-HBO_Max_Logo.svg.png",
            "hulu": "https://upload.wikimedia.org/wikipedia/commons/thumb/e/e4/Hulu_Logo.svg/330px-Hulu_Logo.svg.png",
            "peacock": "https://upload.wikimedia.org/wikipedia/commons/thumb/d/d3/NBCUniversal_Peacock_Logo.svg/330px-NBCUniversal_Peacock_Logo.svg.png",
            "paramount": "https://upload.wikimedia.org/wikipedia/commons/thumb/e/ea/Paramount%2B_logo.png/330px-Paramount%2B_logo.png",
            "starz": "https://upload.wikimedia.org/wikipedia/commons/thumb/0/03/Starz_2022.svg/375px-Starz_2022.svg.png",
            "showtime": "https://upload.wikimedia.org/wikipedia/commons/thumb/b/be/Showtime_Networks.svg/330px-Showtime_Networks.svg.png",
            "apple": "https://upload.wikimedia.org/wikipedia/en/thumb/a/ae/Apple_TV_%28logo%29.svg/177px-Apple_TV_%28logo%29.svg.png",
            "mubi": "https://upload.wikimedia.org/wikipedia/commons/thumb/5/51/Mubi_logo.svg/330px-Mubi_logo.svg.png"
        };

        // Add searchBtn listener
        $("#searchBtn").on("click", function (event) {
            event.preventDefault();
            $("#results").empty();

            var query = $("#search").val().trim();

            var queryURL = `https://${BASE_URL}/search/ultra?country=us&services=${services}&type=movie&order_by=imdb_vote_count&desc=true&language=en&keyword=${query}&output_language=en`;

            fetch(queryURL, options)
                .then(response => response.json())
                .then(function (data) {
                    $("#results").text("URL:" + queryURL);
                    $("#results").append($("<h2>").text("-- Click on the service provider icon to watch the movie --"));
                    console.log(data);
                    var result = data.results;
                    for (var i = 0; i < result.length; i++) {
                        console.log(result[i]);
                        var name = $("<a>")
                            .attr("href", "https://www.themoviedb.org/movie/" + result[i].tmdbID)
                            .append($("<h2>").text(result[i].title));
                        var image = $("<img>")
                            .attr("src", result[i].posterURLs.original)
                            .attr("width", "80px");
                        var overview = $("<p>")
                            .text(result[i].overview);

                        var streaming = $("<div>");
                        console.log(result[i].streamingInfo);
                        var streamingServices = Object.keys(result[i].streamingInfo);
                        var streamingServicesLinks = Object.values(result[i].streamingInfo);
                        for (var k = 0; k < streamingServices.length; k++) {
                            var service = streamingServices[k];
                            var link = streamingServicesLinks[k];
                            console.log(link.us.link);
                            var serviceLink = $("<a>")
                                .attr("href", link.us.link)
                                .append($("<img>")
                                    .attr("src", logos[service])
                                    .attr("width", "50px"));
                            streaming.append(serviceLink);
                        }
                        $("#results").append(name, image, overview, streaming);

                    }
                }).then(function () {
                })
                .catch(err => console.error(err));
        });
    </script>
</body>

</html>