<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1.0">
    <!-- Add jquery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <title>UTELLY</title>
    <header><h1>UTELLY</h1></header>

<body>
    <main>
        <!-- Add search input -->
        <input type="text" id="search" placeholder="Search for a movie">
        <button id="searchBtn">Search</button>
        <div>
            <!-- Add results here -->
            <p id="results"></p>
        </div>
    </main>
    <script>
        var API_KEY = "7871a3a984msh9c8fac100c1803dp118287jsnb2f0f33c75ea";
        var BASE_URL = "utelly-tv-shows-and-movies-availability-v1.p.rapidapi.com";

        // Add searchBtn listener
        $("#searchBtn").on("click", function (event) {
            event.preventDefault();
            $("#results").empty();

            var query = $("#search").val().trim();

            const options = {
                method: 'GET',
                headers: {
                    'X-RapidAPI-Key': API_KEY,
                    'X-RapidAPI-Host': BASE_URL
                }
            };
            var queryURL = `https://${BASE_URL}/lookup?term=${query}&country=us`;
            fetch(queryURL, options)
                .then(response => response.json())
                .then(function (data) {
                    $("#results").text("URL:" + queryURL);
                    $("#results").append($("<h2>").text("-- Click on the service provider icon to watch the movie --"));
                
                    console.log(data.results);
                    var result = data.results;
                    for (var i = 0; i < result.length; i++) {
                        var name = $("<a>")
                            .attr("href",result[i].external_ids.tmdb.url)
                            .append($("<h2>").text(result[i].name));
                        var image = $("<img>")
                            .attr("src", result[i].picture)
                            .attr("width", "80px");
                        var streaming = $("<div>");
                        for (var j = 0; j < result[i].locations.length; j++) {
                            var location = $("<p>").text(result[i].locations[j].display_name);
                            var url = $("<a>")
                                .attr("href", result[i].locations[j].url)
                            var icon = $("<img>")
                                .attr("src", result[i].locations[j].icon)
                                .attr("width", "50px");
                            url.append(icon);
                            streaming.append(url);
                        }

                        $("#results").append(name, image, streaming);

                    }
                })
                .catch(err => console.error(err));
        });
    </script>
</body>

</html>